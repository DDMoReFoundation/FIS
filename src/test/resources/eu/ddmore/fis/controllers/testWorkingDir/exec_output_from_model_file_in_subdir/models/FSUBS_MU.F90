      SUBROUTINE MUMODEL2(THETA,MU_,ICALL,IDEF,NEWIND,&
      EVTREC,DATREC,IREV,NVNT,INDXS,F,G,H,IRGG,GG,NETAS)
      USE NMPRD4P
      USE SIZES,     ONLY: DPSIZE,ISIZE
      USE PRDIMS,    ONLY: GPRD,HPRD,GERD,HERD,GPKD
      USE PRDATA, ONLY: MXSTEP=>MXSTP01
      USE NMPRD_REAL,ONLY: ETA,EPS
      USE NMPRD_INT, ONLY: MSEC=>ISECDER,MFIRST=>IFRSTDER,COMACT,COMSAV,IFIRSTEM
      USE NMPRD_INT, ONLY: MDVRES,ETASXI,NPDE_MODE
      USE NMPRD_REAL, ONLY: DV_LOQ
      USE NMPRD_INT, ONLY: IQUIT
      USE PROCM_INT, ONLY: A_0FLG
      USE PRMOD_REAL,ONLY: A_0,DA_0,D2A_0
      USE NMBAYES_REAL, ONLY: LDF
      IMPLICIT REAL(KIND=DPSIZE) (A-Z)
      REAL(KIND=DPSIZE)   :: MU_(*)
      INTEGER NEWIND
      REAL(KIND=DPSIZE) :: EVTREC
      SAVE
      INTEGER(KIND=ISIZE) :: FIRSTEM
      INTEGER(KIND=ISIZE) :: ICALL,IDEF,IREV,NVNT,INDXS,IRGG,NETAS
      DIMENSION :: IDEF(7,*),THETA(*),EVTREC(IREV,*),INDXS(*),GG(IRGG,GPKD+1,*)
      FIRSTEM=IFIRSTEM
      IF (ICALL <= 1) THEN
      CALL ASSOCNMPRD4
      IDEF(  1,001)= -9
      IDEF(  1,002)= -1
      IDEF(  1,003)=  1
      IDEF(  1,004)=  0
      IDEF(  2,003)=  0
      IDEF(  2,004)=  0
      CALL GETETA(ETA)
      IF (IQUIT == 1) RETURN
      RETURN
      ENDIF
      IF (NEWIND /= 2) THEN
      IF (ICALL == 4) THEN
      CALL SIMETA(ETA)
      ELSE
      CALL GETETA(ETA)
      ENDIF
      IF (IQUIT == 1) RETURN
      ENDIF
 !  level            0
      LOGTWT=EVTREC(NVNT,008)
      POP_CL=THETA(001)
      POP_V=THETA(002)
      POP_KA=THETA(003)
      POP_TLAG=THETA(004)
      BETA_CL_WT=THETA(005)
      BETA_V_WT=THETA(006)
      RUV_PROP=THETA(007)
      RUV_ADD=THETA(008)
      ETA_CL=ETA(001)
      ETA_V=ETA(002)
      ETA_KA=ETA(003)
      ETA_TLAG=ETA(004)
      B00001=DLOG(POP_CL)
      MU_1=B00001+BETA_CL_WT*LOGTWT
      MU_(001)=MU_1
      B00002=MU_1+ETA(001)
      B00003=DEXP(B00002)
      CL=B00003
      B00004=DLOG(POP_V)
      MU_2=B00004+BETA_V_WT*LOGTWT
      MU_(002)=MU_2
      B00005=MU_2+ETA(002)
      B00006=DEXP(B00005)
      V=B00006
      MU_3=DLOG(POP_KA)
      MU_(003)=MU_3
      B00007=MU_3+ETA(003)
      B00008=DEXP(B00007)
      KA=B00008
      MU_4=DLOG(POP_TLAG)
      MU_(004)=MU_4
       RETURN
      B00009=MU_4+ETA(004)
      B00010=DEXP(B00009)
      TLAG=B00010
      IF(A_0FLG == 1)THEN
      A_0(1)=0.D0
      ENDIF
      IF(A_0FLG == 1)THEN
      A_0(2)=0.D0
      ENDIF
      P00001=TLAG
      P00002=KA
      P00003=V
      P00004=CL
      IF (FIRSTEM == 1) THEN
!                      A00040 = DERIVATIVE OF V W.R.T. ETA(002)
      A00040=B00006
!                      A00047 = DERIVATIVE OF P00001 W.R.T. ETA(004)
      A00047=B00010
!                      A00048 = DERIVATIVE OF P00002 W.R.T. ETA(003)
      A00048=B00008
!                      A00049 = DERIVATIVE OF P00003 W.R.T. ETA(002)
      A00049=A00040
!                      A00050 = DERIVATIVE OF P00004 W.R.T. ETA(001)
      A00050=B00003
      GG(001,1,1)=P00001
      GG(001,005,1)=A00047
      GG(002,1,1)=P00002
      GG(002,004,1)=A00048
      GG(003,1,1)=P00003
      GG(003,003,1)=A00049
      GG(004,1,1)=P00004
      GG(004,002,1)=A00050
      ELSE
      GG(001,1,1)=P00001
      GG(002,1,1)=P00002
      GG(003,1,1)=P00003
      GG(004,1,1)=P00004
      ENDIF
      RETURN
      END
