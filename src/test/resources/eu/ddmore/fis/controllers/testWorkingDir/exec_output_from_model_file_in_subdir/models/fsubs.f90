      MODULE NMPRD4P
      USE SIZES, ONLY: DPSIZE
      USE NMPRD4,ONLY: VRBL
      IMPLICIT NONE
      SAVE
      REAL(KIND=DPSIZE), DIMENSION (:),POINTER ::COM
      REAL(KIND=DPSIZE), POINTER ::POP_CL,POP_V,POP_KA,POP_TLAG
      REAL(KIND=DPSIZE), POINTER ::BETA_CL_WT,BETA_V_WT,RUV_PROP
      REAL(KIND=DPSIZE), POINTER ::RUV_ADD,ETA_CL,ETA_V,ETA_KA
      REAL(KIND=DPSIZE), POINTER ::ETA_TLAG,MU_1,CL,MU_2,V,MU_3,KA
      REAL(KIND=DPSIZE), POINTER ::MU_4,TLAG,GUT,CENTRAL,RATEIN,CC_DES
      REAL(KIND=DPSIZE), POINTER ::CC,IPRED,W,Y,IRES,IWRES,A00040
      REAL(KIND=DPSIZE), POINTER ::A00047,A00048,A00049,A00050,E00012
      REAL(KIND=DPSIZE), POINTER ::F00088,E00015,E00016,F00092,F00093
      REAL(KIND=DPSIZE), POINTER ::F00094,D00001,D00002,D00003,D00004
      REAL(KIND=DPSIZE), POINTER ::D00065,D00064,D00066,D00067,D00074
      REAL(KIND=DPSIZE), POINTER ::D00075,D00073,D00072,C00031,D00078
      REAL(KIND=DPSIZE), POINTER ::D00079,D00077,D00076,D00081,D00080
      REAL(KIND=DPSIZE), POINTER ::D00082,D00083,D00090,D00091,D00089
      REAL(KIND=DPSIZE), POINTER ::D00088
      CONTAINS
      SUBROUTINE ASSOCNMPRD4
      COM=>VRBL
      POP_CL=>COM(00001);POP_V=>COM(00002);POP_KA=>COM(00003)
      POP_TLAG=>COM(00004);BETA_CL_WT=>COM(00005)
      BETA_V_WT=>COM(00006);RUV_PROP=>COM(00007);RUV_ADD=>COM(00008)
      ETA_CL=>COM(00009);ETA_V=>COM(00010);ETA_KA=>COM(00011)
      ETA_TLAG=>COM(00012);MU_1=>COM(00013);CL=>COM(00014)
      MU_2=>COM(00015);V=>COM(00016);MU_3=>COM(00017);KA=>COM(00018)
      MU_4=>COM(00019);TLAG=>COM(00020);GUT=>COM(00021)
      CENTRAL=>COM(00022);RATEIN=>COM(00023);CC_DES=>COM(00024)
      CC=>COM(00025);IPRED=>COM(00026);W=>COM(00027);Y=>COM(00028)
      IRES=>COM(00029);IWRES=>COM(00030);A00040=>COM(00031)
      A00047=>COM(00032);A00048=>COM(00033);A00049=>COM(00034)
      A00050=>COM(00035);E00012=>COM(00036);F00088=>COM(00037)
      E00015=>COM(00038);E00016=>COM(00039);F00092=>COM(00040)
      F00093=>COM(00041);F00094=>COM(00042);D00001=>COM(00043)
      D00002=>COM(00044);D00003=>COM(00045);D00004=>COM(00046)
      D00065=>COM(00047);D00064=>COM(00048);D00066=>COM(00049)
      D00067=>COM(00050);D00074=>COM(00051);D00075=>COM(00052)
      D00073=>COM(00053);D00072=>COM(00054);C00031=>COM(00055)
      D00078=>COM(00056);D00079=>COM(00057);D00077=>COM(00058)
      D00076=>COM(00059);D00081=>COM(00060);D00080=>COM(00061)
      D00082=>COM(00062);D00083=>COM(00063);D00090=>COM(00064)
      D00091=>COM(00065);D00089=>COM(00066);D00088=>COM(00067)
      END SUBROUTINE ASSOCNMPRD4
      END MODULE NMPRD4P
      SUBROUTINE MODEL (IDNO,NCM,NPAR,IR,IATT,LINK)                           
      USE PRMOD_CHAR, ONLY: NAME                                              
      USE SIZES,     ONLY: DPSIZE,ISIZE
      USE PRDIMS,    ONLY: GPRD,HPRD,GERD,HERD,GPKD
      INTEGER(KIND=ISIZE) :: IDNO,NCM,NPAR,IR,IATT,LINK,I,J                   
      DIMENSION :: IATT(IR,*),LINK(IR,*)                                      
      SAVE
      INTEGER(KIND=ISIZE), DIMENSION (2,7) :: MOD
      CHARACTER(LEN=8), DIMENSION(2) :: CMOD
      DATA MOD/&                                                              
      1,1,&
      1,1,&
      1,1,&
      1,0,&
      1,0,&
      0,0,& 
      0,0/
      DATA CMOD/ &
      'COMP1   ',&
      'COMP2   '/
      FORALL (I=1:2) NAME(I)=CMOD(I)
      FORALL (I=1:2,J=1:7) IATT(I,J)=MOD(I,J)
      IDNO=9999                                                               
      NCM=  2
      NPAR=004
      RETURN
      END
      SUBROUTINE PK(ICALL,IDEF,THETA,IREV,EVTREC,NVNT,INDXS,IRGG,GG,NETAS)      
      USE NMPRD4P
      USE SIZES,     ONLY: DPSIZE,ISIZE
      USE PRDIMS,    ONLY: GPRD,HPRD,GERD,HERD,GPKD
      USE PRDATA, ONLY: MXSTEP=>MXSTP01
      USE NMPRD_REAL,ONLY: ETA,EPS                                            
      USE NMPRD_INT, ONLY: MSEC=>ISECDER,MFIRST=>IFRSTDER,COMACT,COMSAV,IFIRSTEM
      USE NMPRD_INT, ONLY: MDVRES,ETASXI,NPDE_MODE
      USE NMPRD_REAL, ONLY: DV_LOQ
      USE NMPRD_INT, ONLY: IQUIT
      USE PROCM_INT, ONLY: NEWIND=>PNEWIF                                       
      USE PROCM_INT, ONLY: A_0FLG
      USE PRMOD_REAL,ONLY: A_0,DA_0,D2A_0
      USE NMBAYES_REAL, ONLY: LDF                                             
      IMPLICIT REAL(KIND=DPSIZE) (A-Z)                                          
      REAL(KIND=DPSIZE) :: EVTREC                                               
      SAVE
      INTEGER(KIND=ISIZE) :: FIRSTEM
      INTEGER(KIND=ISIZE) :: ICALL,IDEF,IREV,NVNT,INDXS,IRGG,NETAS              
      DIMENSION :: IDEF(7,*),THETA(*),EVTREC(IREV,*),INDXS(*),GG(IRGG,GPKD+1,*) 
      FIRSTEM=IFIRSTEM
      IF (ICALL <= 1) THEN                                                      
      CALL ASSOCNMPRD4
      IDEF(  1,001)= -9
      IDEF(  1,002)= -1
      IDEF(  1,003)=  1
      IDEF(  1,004)=  0
      IDEF(  2,003)=  0
      IDEF(  2,004)=  0
      CALL GETETA(ETA)                                                          
      IF (IQUIT == 1) RETURN                                                    
      RETURN                                                                    
      ENDIF                                                                     
      IF (NEWIND /= 2) THEN
      IF (ICALL == 4) THEN
      CALL SIMETA(ETA)
      ELSE
      CALL GETETA(ETA)
      ENDIF
      IF (IQUIT == 1) RETURN
      ENDIF
 !  level            0
      LOGTWT=EVTREC(NVNT,008)
      POP_CL=THETA(001) 
      POP_V=THETA(002) 
      POP_KA=THETA(003) 
      POP_TLAG=THETA(004) 
      BETA_CL_WT=THETA(005) 
      BETA_V_WT=THETA(006) 
      RUV_PROP=THETA(007) 
      RUV_ADD=THETA(008) 
      ETA_CL=ETA(001) 
      ETA_V=ETA(002) 
      ETA_KA=ETA(003) 
      ETA_TLAG=ETA(004) 
      B00001=DLOG(POP_CL) 
      MU_1=B00001+BETA_CL_WT*LOGTWT 
      B00002=MU_1+ETA(001) 
      B00003=DEXP(B00002) 
      CL=B00003 
      B00004=DLOG(POP_V) 
      MU_2=B00004+BETA_V_WT*LOGTWT 
      B00005=MU_2+ETA(002) 
      B00006=DEXP(B00005) 
      V=B00006 
      MU_3=DLOG(POP_KA) 
      B00007=MU_3+ETA(003) 
      B00008=DEXP(B00007) 
      KA=B00008 
      MU_4=DLOG(POP_TLAG) 
      B00009=MU_4+ETA(004) 
      B00010=DEXP(B00009) 
      TLAG=B00010 
      IF(A_0FLG == 1)THEN 
      A_0(1)=0.D0 
      ENDIF 
      IF(A_0FLG == 1)THEN 
      A_0(2)=0.D0 
      ENDIF 
      P00001=TLAG 
      P00002=KA 
      P00003=V 
      P00004=CL 
      IF (FIRSTEM == 1) THEN
!                      A00040 = DERIVATIVE OF V W.R.T. ETA(002)
      A00040=B00006 
!                      A00047 = DERIVATIVE OF P00001 W.R.T. ETA(004)
      A00047=B00010 
!                      A00048 = DERIVATIVE OF P00002 W.R.T. ETA(003)
      A00048=B00008 
!                      A00049 = DERIVATIVE OF P00003 W.R.T. ETA(002)
      A00049=A00040 
!                      A00050 = DERIVATIVE OF P00004 W.R.T. ETA(001)
      A00050=B00003 
      GG(001,1,1)=P00001
      GG(001,005,1)=A00047
      GG(002,1,1)=P00002
      GG(002,004,1)=A00048
      GG(003,1,1)=P00003
      GG(003,003,1)=A00049
      GG(004,1,1)=P00004
      GG(004,002,1)=A00050
      ELSE
      GG(001,1,1)=P00001
      GG(002,1,1)=P00002
      GG(003,1,1)=P00003
      GG(004,1,1)=P00004
      ENDIF
      RETURN
      END
      SUBROUTINE ERROR (ICALL,IDEF,THETA,IREV,EVTREC,NVNT,INDXS,F,G,HH)       
      USE NMPRD4P
      USE SIZES,     ONLY: DPSIZE,ISIZE
      USE PRDIMS,    ONLY: GPRD,HPRD,GERD,HERD,GPKD
      USE NMPRD_REAL,ONLY: ETA,EPS                                            
      USE NMPRD_INT, ONLY: MSEC=>ISECDER,MFIRST=>IFRSTDER,IQUIT,IFIRSTEM
      USE NMPRD_INT, ONLY: MDVRES,ETASXI,NPDE_MODE
      USE NMPRD_REAL, ONLY: DV_LOQ
      USE NMPRD_INT, ONLY: NEWL2
      USE PROCM_INT, ONLY: NEWIND=>PNEWIF                                       
      USE PROCM_REAL,ONLY: TSTATE
      USE PROCM_REAL,ONLY: A=>AMNT,DAETA,D2AETA
      IMPLICIT REAL(KIND=DPSIZE) (A-Z)                                        
      REAL(KIND=DPSIZE) :: EVTREC                                             
      SAVE
      INTEGER(KIND=ISIZE) :: ICALL,IDEF,IREV,NVNT,INDXS                       
      DIMENSION :: IDEF(*),THETA(*),EVTREC(IREV,*),INDXS(*)                   
      REAL(KIND=DPSIZE) :: G(GERD,*),HH(HERD,*)                               
      INTEGER(KIND=ISIZE) :: FIRSTEM
      FIRSTEM=IFIRSTEM
      IF (ICALL <= 1) THEN                                                    
      CALL ASSOCNMPRD4
      IDEF(2)=-1
      IDEF(3)=001
      RETURN
      ENDIF
      IF (ICALL == 4) THEN
      IF (NEWL2 == 1) THEN
      CALL SIMEPS(EPS)
      IF (IQUIT == 1) RETURN
      ENDIF
      ENDIF
 !  level            0
      DV=EVTREC(NVNT,006)
      B00001=A(2)/V 
      CC=B00001 
      IPRED=CC 
      W=RUV_ADD+RUV_PROP*IPRED 
      Y=IPRED+W*EPS(001) 
!                      C00031 = DERIVATIVE OF Y W.R.T. EPS(001)
      C00031=W 
      IRES=DV-IPRED 
      IWRES=IRES/W 
      IF (FIRSTEM == 1) THEN !1
      B00002=1.D0/V 
!                      D00050 = DERIVATIVE OF B00001 W.R.T. ETA(004)
      D00050=B00002*DAETA(002,004) 
!                      D00051 = DERIVATIVE OF B00001 W.R.T. ETA(003)
      D00051=B00002*DAETA(002,003) 
!                      D00052 = DERIVATIVE OF B00001 W.R.T. ETA(002)
      D00052=B00002*DAETA(002,002) 
!                      D00053 = DERIVATIVE OF B00001 W.R.T. ETA(001)
      D00053=B00002*DAETA(002,001) 
      B00003=-A(2)/V/V 
!                      D00054 = DERIVATIVE OF B00001 W.R.T. ETA(002)
      D00054=B00003*A00040+D00052 
!                      D00064 = DERIVATIVE OF W W.R.T. ETA(002)
      D00064=RUV_PROP*D00054 
!                      D00065 = DERIVATIVE OF W W.R.T. ETA(001)
      D00065=RUV_PROP*D00053 
!                      D00066 = DERIVATIVE OF W W.R.T. ETA(003)
      D00066=RUV_PROP*D00051 
!                      D00067 = DERIVATIVE OF W W.R.T. ETA(004)
      D00067=RUV_PROP*D00050 
!                      D00068 = DERIVATIVE OF Y W.R.T. ETA(002)
      D00068=D00054 
!                      D00069 = DERIVATIVE OF Y W.R.T. ETA(001)
      D00069=D00053 
!                      D00070 = DERIVATIVE OF Y W.R.T. ETA(003)
      D00070=D00051 
!                      D00071 = DERIVATIVE OF Y W.R.T. ETA(004)
      D00071=D00050 
!                      D00072 = DERIVATIVE OF Y W.R.T. ETA(004)
      D00072=EPS(001)*D00067+D00071 
!                      D00073 = DERIVATIVE OF Y W.R.T. ETA(003)
      D00073=EPS(001)*D00066+D00070 
!                      D00074 = DERIVATIVE OF Y W.R.T. ETA(001)
      D00074=EPS(001)*D00065+D00069 
!                      D00075 = DERIVATIVE OF Y W.R.T. ETA(002)
      D00075=EPS(001)*D00064+D00068 
!                      D00076 = DERIVATIVE OF C00031 W.R.T. ETA(004)
      D00076=D00067 
!                      D00077 = DERIVATIVE OF C00031 W.R.T. ETA(003)
      D00077=D00066 
!                      D00078 = DERIVATIVE OF C00031 W.R.T. ETA(001)
      D00078=D00065 
!                      D00079 = DERIVATIVE OF C00031 W.R.T. ETA(002)
      D00079=D00064 
!                      D00080 = DERIVATIVE OF IRES W.R.T. ETA(002)
      D00080=-D00054 
!                      D00081 = DERIVATIVE OF IRES W.R.T. ETA(001)
      D00081=-D00053 
!                      D00082 = DERIVATIVE OF IRES W.R.T. ETA(003)
      D00082=-D00051 
!                      D00083 = DERIVATIVE OF IRES W.R.T. ETA(004)
      D00083=-D00050 
      B00006=1.D0/W 
!                      D00084 = DERIVATIVE OF IWRES W.R.T. ETA(004)
      D00084=B00006*D00083 
!                      D00085 = DERIVATIVE OF IWRES W.R.T. ETA(003)
      D00085=B00006*D00082 
!                      D00086 = DERIVATIVE OF IWRES W.R.T. ETA(001)
      D00086=B00006*D00081 
!                      D00087 = DERIVATIVE OF IWRES W.R.T. ETA(002)
      D00087=B00006*D00080 
      B00007=-IRES/W/W 
!                      D00088 = DERIVATIVE OF IWRES W.R.T. ETA(004)
      D00088=B00007*D00067+D00084 
!                      D00089 = DERIVATIVE OF IWRES W.R.T. ETA(003)
      D00089=B00007*D00066+D00085 
!                      D00090 = DERIVATIVE OF IWRES W.R.T. ETA(001)
      D00090=B00007*D00065+D00086 
!                      D00091 = DERIVATIVE OF IWRES W.R.T. ETA(002)
      D00091=B00007*D00064+D00087 
      G(001,1)=D00074
      G(002,1)=D00075
      G(003,1)=D00073
      G(004,1)=D00072
      ENDIF !1
      HH(001,1)=C00031
      IF (FIRSTEM == 1) THEN !2
      HH(001,002)=D00078
      HH(001,003)=D00079
      HH(001,004)=D00077
      HH(001,005)=D00076
      ENDIF !2
      F=Y
      RETURN
      END
      SUBROUTINE TOL(NRD)
      USE SIZES,     ONLY: DPSIZE,ISIZE
      USE PRDIMS,    ONLY: GPRD,HPRD,GERD,HERD,GPKD
      DIMENSION :: NRD(*)
      INTEGER(KIND=ISIZE) :: NRD
      NRD(1)=9 
      CALL TOLC(NRD(1))
      RETURN
      END
      SUBROUTINE DES (A,P,T,DADT,IR,DA,DP,DT)                                 
      USE NMPRD4P
      USE SIZES,     ONLY: DPSIZE,ISIZE
      USE PRDIMS,    ONLY: GPRD,HPRD,GERD,HERD,GPKD
      USE NMPRD_INT, ONLY: MSEC=>ISECDER,MFIRST=>IFRSTDER,IFIRSTEM
      USE NMPRD_INT, ONLY: MDVRES,ETASXI,NPDE_MODE
      USE NMPRD_REAL, ONLY: DV_LOQ
      USE PRMOD_INT, ONLY: ICALL=>ICALLD,IDEFD,IDEFA
      IMPLICIT REAL(KIND=DPSIZE) (A-Z)                                        
      SAVE
      INTEGER(KIND=ISIZE) :: IR                                               
      DIMENSION :: A(*),P(*),DADT(*),DA(IR,*),DP(IR,*),DT(*)                  
      INTEGER(KIND=ISIZE) :: FIRSTEM
      FIRSTEM=IFIRSTEM
      IF (ICALL == 1) THEN
      CALL ASSOCNMPRD4
      IDEFD(1)=  0
      RETURN
      ENDIF
 !  level            0
 !  level            0
      GUT=A(1) 
      CENTRAL=A(2) 
      Q00000=0.D0 
      Q00001=1.D0 
      IF(T >= P(001))THEN 
      Q00000=1.D0 
      Q00001=0.D0 
      B00003=GUT*P(002) 
      ELSE 
      ENDIF 
      B00007=Q00000*B00003+Q00001*0.D0 
      RATEIN=B00007 
      B00008=CENTRAL/P(003) 
      CC_DES=B00008 
      DADT(1)=-RATEIN 
      B00012=P(004)*CENTRAL 
      B00013=B00012/P(003) 
      DADT(2)=RATEIN-B00013 
      IF (FIRSTEM == 1) THEN ! 1
!                      E00008 = DERIVATIVE OF B00007 W.R.T. A(001)
      E00008=Q00000*P(002) 
!                      F00084 = DERIVATIVE OF B00007 W.R.T. P(002)
      F00084=Q00000*GUT 
      B00009=1.D0/P(003) 
      B00010=-CENTRAL/P(003)/P(003) 
!                      E00012 = DERIVATIVE OF DADT(1) W.R.T. A(001)
      E00012=-E00008 
!                      F00088 = DERIVATIVE OF DADT(1) W.R.T. P(002)
      F00088=-F00084 
      B00014=1.D0/P(003) 
!                      E00014 = DERIVATIVE OF B00013 W.R.T. A(002)
      E00014=B00014*P(004) 
!                      E00015 = DERIVATIVE OF DADT(2) W.R.T. A(001)
      E00015=E00008 
!                      E00016 = DERIVATIVE OF DADT(2) W.R.T. A(002)
      E00016=-E00014 
      B00016=1.D0/P(003) 
!                      F00090 = DERIVATIVE OF B00013 W.R.T. P(004)
      F00090=B00016*CENTRAL 
      B00017=-B00012/P(003)/P(003) 
!                      F00092 = DERIVATIVE OF DADT(2) W.R.T. P(002)
      F00092=F00084 
!                      F00093 = DERIVATIVE OF DADT(2) W.R.T. P(003)
      F00093=-B00017 
!                      F00094 = DERIVATIVE OF DADT(2) W.R.T. P(004)
      F00094=-F00090 
      ENDIF !1
      IF (FIRSTEM == 1) THEN !3
      DA(  1,  1)=E00012
      DA(  2,  1)=E00015
      DA(  2,  2)=E00016
      DP(  1,002)=F00088
      DP(  2,002)=F00092
      DP(  2,003)=F00093
      DP(  2,004)=F00094
      ENDIF !3
      RETURN
      END
      SUBROUTINE FSIZESR(NAME_FSIZES,F_SIZES)
      USE SIZES, ONLY: ISIZE
      INTEGER(KIND=ISIZE), DIMENSION(*) :: F_SIZES
      CHARACTER(LEN=*),    DIMENSION(*) :: NAME_FSIZES
      NAME_FSIZES(01)='LTH'; F_SIZES(01)=8
      NAME_FSIZES(02)='LVR'; F_SIZES(02)=5
      NAME_FSIZES(03)='LVR2'; F_SIZES(03)=0
      NAME_FSIZES(04)='LPAR'; F_SIZES(04)=19
      NAME_FSIZES(05)='LPAR3'; F_SIZES(05)=0
      NAME_FSIZES(06)='NO'; F_SIZES(06)=0
      NAME_FSIZES(07)='MMX'; F_SIZES(07)=1
      NAME_FSIZES(08)='LNP4'; F_SIZES(08)=0
      NAME_FSIZES(09)='LSUPP'; F_SIZES(09)=1
      NAME_FSIZES(10)='LIM7'; F_SIZES(10)=0
      NAME_FSIZES(11)='LWS3'; F_SIZES(11)=0
      NAME_FSIZES(12)='MAXIDS'; F_SIZES(12)=32
      NAME_FSIZES(13)='LIM1'; F_SIZES(13)=0
      NAME_FSIZES(14)='LIM2'; F_SIZES(14)=0
      NAME_FSIZES(15)='LIM3'; F_SIZES(15)=0
      NAME_FSIZES(16)='LIM4'; F_SIZES(16)=0
      NAME_FSIZES(17)='LIM5'; F_SIZES(17)=0
      NAME_FSIZES(18)='LIM6'; F_SIZES(18)=0
      NAME_FSIZES(19)='LIM8'; F_SIZES(19)=0
      NAME_FSIZES(20)='LIM11'; F_SIZES(20)=0
      NAME_FSIZES(21)='LIM13'; F_SIZES(21)=0
      NAME_FSIZES(22)='LIM15'; F_SIZES(22)=0
      NAME_FSIZES(23)='LIM16'; F_SIZES(23)=0
      NAME_FSIZES(24)='MAXRECID'; F_SIZES(24)=0
      NAME_FSIZES(25)='PC'; F_SIZES(25)=0
      NAME_FSIZES(26)='PCT'; F_SIZES(26)=1
      NAME_FSIZES(27)='PIR'; F_SIZES(27)=1
      NAME_FSIZES(28)='PD'; F_SIZES(28)=9
      NAME_FSIZES(29)='PAL'; F_SIZES(29)=0
      NAME_FSIZES(30)='MAXFCN'; F_SIZES(30)=0
      NAME_FSIZES(31)='MAXIC'; F_SIZES(31)=0
      NAME_FSIZES(32)='PG'; F_SIZES(32)=0
      NAME_FSIZES(33)='NPOPMIXMAX'; F_SIZES(33)=0
      NAME_FSIZES(34)='MAXOMEG'; F_SIZES(34)=4
      NAME_FSIZES(35)='MAXPTHETA'; F_SIZES(35)=9
      NAME_FSIZES(36)='MAXITER'; F_SIZES(36)=20
      NAME_FSIZES(37)='ISAMPLEMAX'; F_SIZES(37)=0
      NAME_FSIZES(38)='DIMTMP'; F_SIZES(38)=0
      NAME_FSIZES(39)='DIMCNS'; F_SIZES(39)=0
      NAME_FSIZES(40)='DIMNEW'; F_SIZES(40)=0
      NAME_FSIZES(41)='PDT'; F_SIZES(41)=15
      NAME_FSIZES(42)='LADD_MAX'; F_SIZES(42)=0
      NAME_FSIZES(43)='MAXSIDL'; F_SIZES(43)=0
      NAME_FSIZES(44)='NTT'; F_SIZES(44)=8
      NAME_FSIZES(45)='NOMEG'; F_SIZES(45)=4
      NAME_FSIZES(46)='NSIGM'; F_SIZES(46)=1
      NAME_FSIZES(47)='PPDT'; F_SIZES(47)=12
      RETURN
      END SUBROUTINE FSIZESR
      SUBROUTINE MUMODEL2(THETA,MU_,ICALL,IDEF,NEWIND,&
      EVTREC,DATREC,IREV,NVNT,INDXS,F,G,H,IRGG,GG,NETAS)
      USE NMPRD4P
      USE SIZES,     ONLY: DPSIZE,ISIZE
      USE PRDIMS,    ONLY: GPRD,HPRD,GERD,HERD,GPKD
      USE PRDATA, ONLY: MXSTEP=>MXSTP01
      USE NMPRD_REAL,ONLY: ETA,EPS
      USE NMPRD_INT, ONLY: MSEC=>ISECDER,MFIRST=>IFRSTDER,COMACT,COMSAV,IFIRSTEM
      USE NMPRD_INT, ONLY: MDVRES,ETASXI,NPDE_MODE
      USE NMPRD_REAL, ONLY: DV_LOQ
      USE NMPRD_INT, ONLY: IQUIT
      USE PROCM_INT, ONLY: A_0FLG
      USE PRMOD_REAL,ONLY: A_0,DA_0,D2A_0
      USE NMBAYES_REAL, ONLY: LDF
      IMPLICIT REAL(KIND=DPSIZE) (A-Z)
      REAL(KIND=DPSIZE)   :: MU_(*)
      INTEGER NEWIND
      REAL(KIND=DPSIZE) :: EVTREC
      SAVE
      INTEGER(KIND=ISIZE) :: FIRSTEM
      INTEGER(KIND=ISIZE) :: ICALL,IDEF,IREV,NVNT,INDXS,IRGG,NETAS
      DIMENSION :: IDEF(7,*),THETA(*),EVTREC(IREV,*),INDXS(*),GG(IRGG,GPKD+1,*)
      FIRSTEM=IFIRSTEM
      IF (ICALL <= 1) THEN
      CALL ASSOCNMPRD4
      IDEF(  1,001)= -9
      IDEF(  1,002)= -1
      IDEF(  1,003)=  1
      IDEF(  1,004)=  0
      IDEF(  2,003)=  0
      IDEF(  2,004)=  0
      CALL GETETA(ETA)
      IF (IQUIT == 1) RETURN
      RETURN
      ENDIF
      IF (NEWIND /= 2) THEN
      IF (ICALL == 4) THEN
      CALL SIMETA(ETA)
      ELSE
      CALL GETETA(ETA)
      ENDIF
      IF (IQUIT == 1) RETURN
      ENDIF
 !  level            0
      LOGTWT=EVTREC(NVNT,008)
      POP_CL=THETA(001)
      POP_V=THETA(002)
      POP_KA=THETA(003)
      POP_TLAG=THETA(004)
      BETA_CL_WT=THETA(005)
      BETA_V_WT=THETA(006)
      RUV_PROP=THETA(007)
      RUV_ADD=THETA(008)
      ETA_CL=ETA(001)
      ETA_V=ETA(002)
      ETA_KA=ETA(003)
      ETA_TLAG=ETA(004)
      B00001=DLOG(POP_CL)
      MU_1=B00001+BETA_CL_WT*LOGTWT
      MU_(001)=MU_1
      B00002=MU_1+ETA(001)
      B00003=DEXP(B00002)
      CL=B00003
      B00004=DLOG(POP_V)
      MU_2=B00004+BETA_V_WT*LOGTWT
      MU_(002)=MU_2
      B00005=MU_2+ETA(002)
      B00006=DEXP(B00005)
      V=B00006
      MU_3=DLOG(POP_KA)
      MU_(003)=MU_3
      B00007=MU_3+ETA(003)
      B00008=DEXP(B00007)
      KA=B00008
      MU_4=DLOG(POP_TLAG)
      MU_(004)=MU_4
       RETURN
      B00009=MU_4+ETA(004)
      B00010=DEXP(B00009)
      TLAG=B00010
      IF(A_0FLG == 1)THEN
      A_0(1)=0.D0
      ENDIF
      IF(A_0FLG == 1)THEN
      A_0(2)=0.D0
      ENDIF
      P00001=TLAG
      P00002=KA
      P00003=V
      P00004=CL
      IF (FIRSTEM == 1) THEN
!                      A00040 = DERIVATIVE OF V W.R.T. ETA(002)
      A00040=B00006
!                      A00047 = DERIVATIVE OF P00001 W.R.T. ETA(004)
      A00047=B00010
!                      A00048 = DERIVATIVE OF P00002 W.R.T. ETA(003)
      A00048=B00008
!                      A00049 = DERIVATIVE OF P00003 W.R.T. ETA(002)
      A00049=A00040
!                      A00050 = DERIVATIVE OF P00004 W.R.T. ETA(001)
      A00050=B00003
      GG(001,1,1)=P00001
      GG(001,005,1)=A00047
      GG(002,1,1)=P00002
      GG(002,004,1)=A00048
      GG(003,1,1)=P00003
      GG(003,003,1)=A00049
      GG(004,1,1)=P00004
      GG(004,002,1)=A00050
      ELSE
      GG(001,1,1)=P00001
      GG(002,1,1)=P00002
      GG(003,1,1)=P00003
      GG(004,1,1)=P00004
      ENDIF
      RETURN
      END
